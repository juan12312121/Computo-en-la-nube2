<!-- NAVBAR -->
<app-navbar (publicacionCreada)="onPublicacionCreada($event)"></app-navbar>

<!-- LAYOUT PRINCIPAL -->
<div class="max-w-7xl mx-auto px-2 sm:px-4 py-3 sm:py-6">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6">

    <!-- SIDEBAR IZQUIERDO -->
    <aside class="hidden lg:block lg:col-span-3">
      <div class="sticky top-20 space-y-4">
        <app-sidebar-perfil
          [usuario]="usuarioActual"
          [cardBg]="currentTheme.cardBg || ''"
          [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
          [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
          [borderColor]="currentTheme.borderColor || ''"
          [accentBg]="currentThemeData.accentBg || ''"
          [borderClass]="currentTheme.id === 'midnight' || currentTheme.id === 'neon' || currentTheme.id === 'toxic' ? 'border-gray-800' : 'border-white'">
        </app-sidebar-perfil>

        <app-sidebar-categorias
          [categorias]="categoriasDisponibles"
          [categoriaSeleccionada]="categoriaSeleccionada"
          [cardBg]="currentTheme.cardBg || ''"
          [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
          [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
          [accentBg]="currentThemeData.accentBg || ''"
          [hoverBackground]="currentThemeData.hoverBackground || ''"
          (seleccionarCategoria)="filtrarPorCategoria($event)">
        </app-sidebar-categorias>
      </div>
    </aside>

    <!-- FEED CENTRAL -->
    <main class="lg:col-span-6 space-y-3 sm:space-y-4">
      <!-- LOADING STATE -->
      <div *ngIf="isLoading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2"
             [ngClass]="'border-' + currentThemeData.textPrimary?.replace('text-', '')"></div>
        <p class="text-sm font-medium mt-3" [ngClass]="currentTheme.textSecondaryClass">
          Cargando publicaciones...
        </p>
      </div>

      <!-- ERROR STATE -->
      <div *ngIf="!isLoading && errorMessage" 
           class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
        <i class="fas fa-exclamation-circle mr-2"></i>{{ errorMessage }}
      </div>

      <!-- FILTRO ACTIVO -->
      <div *ngIf="categoriaSeleccionada && !isLoading" 
           class="rounded-lg p-3 border flex items-center justify-between"
           [ngClass]="[currentTheme.cardBg || '', currentTheme.borderColor || '']">
        <div class="flex items-center gap-2">
          <i class="fas fa-filter" [ngClass]="currentTheme.textPrimaryClass"></i>
          <span class="font-medium text-sm" [ngClass]="currentTheme.textPrimaryClass">
            Filtrando por: <strong>{{ categoriaSeleccionada }}</strong>
          </span>
          <span class="text-xs px-2 py-0.5 rounded-full text-white" 
                [ngClass]="currentThemeData.accentBg || ''">
            {{ postsFiltrados.length }} publicaciones
          </span>
        </div>
        <button (click)="filtrarPorCategoria(categoriaSeleccionada!)"
                class="text-sm font-medium hover:underline"
                [ngClass]="currentTheme.textSecondaryClass">
          <i class="fas fa-times mr-1"></i>Limpiar filtro
        </button>
      </div>

      <!-- POSTS -->
      <app-post-card 
        *ngFor="let post of postsFiltrados; trackBy: trackByPostId"
        [post]="post"
        [currentTheme]="currentTheme"
        [usuarioActualId]="usuarioActualId"
        [fotosPerfilCache]="fotosPerfilCache"
        [usuarioActual]="usuarioActual"
        (postLikeChanged)="onPostLikeChanged($event)"
        (postHidden)="onPostHidden($event)"
        (postNoInteresa)="onPostNoInteresa($event)"
        (postReported)="onPostReported($event)"
        (postShared)="onPostShared($event)"
        (postEdited)="onPostEdited($event)"
        (postDeleted)="onPostDeleted($event)"
        (openPostDetailModal)="onOpenPostDetailModal($event)">
      </app-post-card>

      <!-- EMPTY STATE -->
      <div *ngIf="!isLoading && postsFiltrados.length === 0" class="text-center py-12">
        <i class="fas fa-inbox text-4xl text-gray-300 mb-3"></i>
        <p class="text-gray-600 font-medium">
          {{ categoriaSeleccionada ? 'No hay publicaciones en esta categor√≠a' : 'No hay publicaciones' }}
        </p>
        <button *ngIf="categoriaSeleccionada"
                (click)="filtrarPorCategoria(categoriaSeleccionada!)"
                class="mt-3 px-4 py-2 rounded-lg font-medium text-sm text-white"
                [ngClass]="currentThemeData.accentBg || ''">
          <i class="fas fa-times mr-2"></i>Limpiar filtro
        </button>
      </div>
    </main>

    <!-- SIDEBAR DERECHO -->
    <aside class="hidden lg:block lg:col-span-3">
      <div class="sticky top-20 space-y-4">
        <app-sidebar-usuarios-activos
    [cardBg]="currentTheme.cardBg || ''"
    [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
    [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
    [accentBg]="currentThemeData.accentBg || ''"
    [hoverBackground]="currentThemeData.hoverBackground || ''"
    [borderClass]="currentTheme.id === 'midnight' || currentTheme.id === 'neon' || currentTheme.id === 'toxic' ? 'border-gray-800' : 'border-white'">
  </app-sidebar-usuarios-activos>
  
        <app-app-sidebar-sugerencias
          [usuarioActualId]="usuarioActualId"
          [seguidosIds]="seguidosIds"
          [cardBg]="currentTheme.cardBg || ''"
          [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
          [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
          [accentBg]="currentThemeData.accentBg || ''"
          [hoverBackground]="currentThemeData.hoverBackground || ''"
          (seguirUsuario)="seguirUsuario($event)"
          (sugerenciasCargadas)="onSugerenciasCargadas($event)">
        </app-app-sidebar-sugerencias>
      </div>
    </aside>
  </div>
</div>

<!-- MODAL DETALLE POST -->
<app-detalle-post 
  [post]="selectedPost"
  [isVisible]="showPostDetailModal"
  (close)="closePostDetail()">
</app-detalle-post>

<!-- MODAL NO ME INTERESA -->
<app-app-modal-no-interesa
  [isVisible]="showNoInteresaModal"
  [loading]="noInteresaLoading"
  [success]="noInteresaSuccess"
  [error]="noInteresaError"
  [cardBg]="currentTheme.cardBg || ''"
  [borderColor]="currentTheme.borderColor || ''"
  [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
  [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
  (cerrar)="closeNoInteresaModal()"
  (confirmar)="submitNoInteresa()">
</app-app-modal-no-interesa>

<!-- MODAL REPORTES -->
<app-modal-reporte
  [isVisible]="showReportModal"
  [loading]="reportLoading"
  [success]="reportSuccess"
  [error]="reportError"
  [motivo]="reportMotivo"
  [descripcion]="reportDescripcion"
  [motivosValidos]="obtenerMotivosValidos()"
  [cardBg]="currentTheme.cardBg || ''"
  [borderColor]="currentTheme.borderColor || ''"
  [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
  [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
  (cerrar)="closeReportModal()"
  (enviarReporte)="submitReport()"
  (motivoChange)="reportMotivo = $event"
  (descripcionChange)="reportDescripcion = $event">
</app-modal-reporte>

<!-- MODAL COMPARTIR -->
<app-modal-compartir
  [isVisible]="showShareModal"
  [postId]="sharePostId"
  [linkCopiado]="linkCopied"
  [cardBg]="currentTheme.cardBg || ''"
  [borderColor]="currentTheme.borderColor || ''"
  [textPrimaryClass]="currentTheme.textPrimaryClass || ''"
  [textSecondaryClass]="currentTheme.textSecondaryClass || ''"
  (cerrar)="closeShareModal()"
  (compartirEn)="shareToSocial($event)"
  (copiarLink)="copyLink()">
</app-modal-compartir>