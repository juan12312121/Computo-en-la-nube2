<app-navbar (openCreate)="openCreateModal()"></app-navbar>

<!-- Loading State -->
<app-profile-loading 
  *ngIf="cargandoPerfil"
  [currentTheme]="currentTheme">
</app-profile-loading>

<!-- Error State -->
<app-profile-error
  *ngIf="errorCarga && !cargandoPerfil"
  [currentTheme]="currentTheme"
  (reintentar)="reintentarCarga()">
</app-profile-error>

<!-- Profile Container -->
<div *ngIf="!cargandoPerfil && !errorCarga && usuario" class="max-w-5xl mx-auto px-4 py-6">
  
  <!-- Profile Header Card -->
  <app-profile-header
    [usuario]="usuario"
    [currentTheme]="currentTheme"
    [isOwnProfile]="isOwnProfile"
    [estaSiguiendo]="estaSiguiendo"
    [cargandoAccion]="cargandoSeguir"
    [profileImage]="getProfileImage()"
    [coverImage]="getCoverImage()"
    [iniciales]="getInitials()"
    [totalPublicaciones]="publicacionesReales.length"
    [textoBoton]="getButtonText()"
    [iconoBoton]="getButtonIcon()"
    (cambiarBanner)="abrirModalCambiarBanner()"
    (accionBoton)="toggleProfileMode()"
    (abrirSeguidores)="abrirSeguidores()"
    (abrirSiguiendo)="abrirSiguiendo()">
  </app-profile-header>

  <!-- Tabs Navigation -->
  <app-profile-tabs
    [activeTab]="activeTab"
    [currentTheme]="currentTheme"
    (cambiarTab)="switchTab($event)">
  </app-profile-tabs>

  <!-- Content Area -->
  <div>
    <!-- Todo Tab Content -->
    <div *ngIf="activeTab === 'todo'">
      <app-publicaciones-perfil
        [publicaciones]="publicacionesReales"
        [cargando]="cargandoPublicaciones"
        [usuarioNombre]="usuario ? usuario.nombre_completo : 'Usuario'"
        [usuarioIniciales]="getInitials()"
        [apiBaseUrl]="apiBaseUrl"
        [usuarioFotoPerfil]="getProfileImage()"
        (likeToggled)="onLikeToggled($event)"
        (commentAdded)="onCommentAdded($event)">
      </app-publicaciones-perfil>
    </div>

    <!-- Fotos Tab Content -->
    <div *ngIf="activeTab === 'fotos'">
      <app-fotos-perfil
        [photos]="photos"
        [cargando]="cargandoPublicaciones">
      </app-fotos-perfil>
    </div>

    <!-- Documentos Tab Content -->
    <div *ngIf="activeTab === 'documentos'">
      <app-documentos-lista
        [documents]="documents"
        [currentTheme]="currentTheme"
        (downloadDocument)="onDocumentDownload($event)">
      </app-documentos-lista>
    </div>

    <!-- Secciones Tab Content -->
    <div *ngIf="activeTab === 'secciones'">
      <app-secciones-grid
        [sections]="sections"
        [currentTheme]="currentTheme"
        (sectionSelected)="onSectionSelected($event)">
      </app-secciones-grid>
    </div>
  </div>
</div>

<!-- Modal de Editar Perfil (solo si es mi perfil) -->
<app-modal-editar-perfil
  *ngIf="isOwnProfile"
  [isVisible]="showEditModal"
  [usuario]="$any(usuario)"
  [currentTheme]="currentTheme"
  [guardando]="guardandoPerfil"
  [errorGuardado]="errorGuardado"
  [mensajeError]="mensajeError"
  [apiBaseUrl]="apiBaseUrl"
  (close)="cerrarModalEdicion()"
  (guardar)="guardarPerfil($event)">
</app-modal-editar-perfil>

<!-- Modal de Cambiar Banner (solo si es mi perfil) -->
<app-modal-cambiar-banner
  *ngIf="isOwnProfile"
  [isVisible]="showBannerModal"
  [usuario]="$any(usuario)"
  [currentTheme]="currentTheme"
  [guardando]="guardandoBanner"
  [errorBanner]="errorBanner"
  [apiBaseUrl]="apiBaseUrl"
  (close)="cerrarModalBanner()"
  (guardar)="guardarBanner($event)"
  (eliminar)="eliminarBanner()">
</app-modal-cambiar-banner>

<!-- Modal de Seguidores/Siguiendo -->
<app-modal-seguidores
  [isVisible]="showSeguidoresModal"
  [tipo]="tipoModalSeguidores"
  [usuarioId]="usuario?.id || null"
  [currentTheme]="currentTheme"
  [apiBaseUrl]="apiBaseUrl"
  (close)="cerrarModalSeguidores()">
</app-modal-seguidores>