<!-- Modal de Crear Post -->
<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" (click)="closeModal()">
  <div
    [ngClass]="[currentTheme.cardBg, currentTheme.textPrimaryClass]"
    class="rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()">

    <!-- Header -->
    <div
      [ngClass]="[currentTheme.cardBg, currentTheme.borderColor]"
      class="sticky top-0 border-b px-6 py-4 flex items-center justify-between rounded-t-2xl">
      <h2
        class="text-transparent text-xl font-bold"
        [ngStyle]="{'background': currentTheme.color, '-webkit-background-clip': 'text', '-webkit-text-fill-color': 'transparent', 'background-clip': 'text'}"
      >
        Crear Publicación
      </h2>
      <button (click)="closeModal()" [ngClass]="[currentTheme.textSecondaryClass, currentTheme.hoverText]" class="transition" [disabled]="publicando">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>

    <!-- Cuerpo del modal -->
    <div class="p-6 space-y-4">

      <!-- Usuario info -->
      <div class="flex items-center gap-3">
        <img
          [src]="userAvatar"
          [alt]="userName"
          class="w-12 h-12 rounded-full border-2 object-cover"
          [ngClass]="currentTheme.accentBorder"
          (error)="$event.target.src = 'https://ui-avatars.com/api/?name=' + userName + '&background=random&size=200'"
        >
        <div class="flex-1">
          <p [ngClass]="currentTheme.textPrimaryClass" class="font-semibold">{{ userName }}</p>
          <p [ngClass]="currentTheme.textSecondaryClass" class="text-sm">{{ userUsername }}</p>
        </div>

        <!-- Badge de categoría seleccionada -->
        <div *ngIf="categoriaActual"
             [class]="categoriaActual.color + ' text-white px-3 py-1 rounded-full text-sm font-medium flex items-center gap-2 category-badge'">
          <i class="fas fa-tag"></i>
          {{ categoriaActual.label }}
        </div>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="mensajeError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl flex items-center gap-2">
        <i class="fas fa-exclamation-circle"></i>
        <span>{{ mensajeError }}</span>
      </div>

      <!-- Textarea -->
      <textarea
        [(ngModel)]="postContent"
        placeholder="¿Qué estás pensando?"
        class="w-full min-h-[150px] p-4 border rounded-xl focus:ring-2 focus:border-transparent resize-none"
        [ngClass]="[currentTheme.borderColor, currentTheme.textPrimaryClass, currentTheme.bgPrimary.replace('bg-', 'focus:ring-')]"
        [style.background-color]="currentTheme.id === 'midnight' || currentTheme.id === 'neon' || currentTheme.id === 'toxic' ? 'var(--picker-bg-color)' : ''"
        [disabled]="publicando"
      ></textarea>

      <!-- Vista previa de imagen -->
      <div *ngIf="selectedImage" class="relative">
        <img [src]="selectedImage" alt="preview" class="w-full rounded-xl max-h-96 object-cover">
        <button
          (click)="removeImage()"
          [disabled]="publicando"
          class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Selector de Categoría - INLINE con tema adaptado -->
      <!-- Selector de Categoría -->
<div *ngIf="mostrarSelectorCategoria"
     class="category-selector-container border-2 rounded-xl p-4 space-y-3"
     [ngClass]="currentTheme.borderColor"
     [style.background-color]="'var(--picker-bg-color)'"
     [style.border-color]="'var(--picker-border-color)'">

  <!-- Header unificado -->
  <div class="flex items-center justify-between mb-2 picker-header">
    <div class="font-semibold flex items-center gap-2 picker-title">
      <i class="fas fa-tag text-xl" [ngClass]="currentTheme.accentColor"></i>
      <span class="picker-text">Selecciona una categoría</span>
    </div>
    <button (click)="toggleSelectorCategoria()" 
            class="transition hover:scale-110 picker-close-btn">
      <i class="fas fa-times text-xl"></i>
    </button>
  </div>

  <!-- Contenedor scrollable de categorías -->
  <div class="max-h-48 overflow-y-auto pr-2 -mr-2">
    <div class="grid grid-cols-2 lg:grid-cols-3 gap-2">
      <button
        *ngFor="let categoria of categorias"
        (click)="seleccionarCategoria(categoria.value)"
        type="button"
        class="category-selector w-full flex items-center gap-2 px-3 py-2.5 rounded-lg transition"
        [ngClass]="{
          'ring-2 shadow-md': categoriaSeleccionada === categoria.value
        }"
        [class]="(categoriaSeleccionada === categoria.value ? currentTheme.bgPrimary.replace('bg-', 'ring-') : '')"
        [style.background-color]="categoriaSeleccionada === categoria.value ? 'var(--hover-bg-color)' : (currentTheme.id === 'midnight' || currentTheme.id === 'neon' || currentTheme.id === 'toxic' ? '#1e293b' : '#ffffff')">
        <div [class]="categoria.color + ' w-8 h-8 rounded-full flex items-center justify-center text-white flex-shrink-0'">
          <i class="fas fa-tag text-xs"></i>
        </div>
        <span class="font-medium text-sm flex-1 text-left truncate"
              [style.color]="'var(--picker-text-color)'">{{ categoria.label }}</span>
        <i *ngIf="categoriaSeleccionada === categoria.value" class="fas fa-check flex-shrink-0" [ngClass]="currentTheme.accentColor"></i>
      </button>
    </div>
  </div>
</div>

<!-- Selector de Emojis -->
<div *ngIf="mostrarEmojiPicker"
     class="emoji-picker-container border-2 rounded-xl p-4 space-y-3"
     [ngClass]="currentTheme.borderColor"
     [style.background-color]="'var(--picker-bg-color)'"
     [style.border-color]="'var(--picker-border-color)'">

  <!-- Header unificado (mismo estilo que categorías) -->
  <div class="flex items-center justify-between mb-2 picker-header">
    <div class="font-semibold flex items-center gap-2 picker-title">
      <i class="fas fa-smile text-xl" [ngClass]="currentTheme.accentColor"></i>
      <span class="picker-text">Selecciona un emoji</span>
    </div>
    <button (click)="toggleEmojiPicker()" 
            class="transition hover:scale-110 picker-close-btn">
      <i class="fas fa-times text-xl"></i>
    </button>
  </div>

  <!-- Contenido -->
  <div class="rounded-lg p-3 max-h-48 overflow-y-auto"
       [style.background-color]="currentTheme.id === 'midnight' || currentTheme.id === 'neon' || currentTheme.id === 'toxic' ? '#1e293b' : '#f9fafb'">
    <div class="grid grid-cols-8 gap-1">
      <button
        *ngFor="let emoji of emojis"
        (click)="agregarEmoji(emoji.character)"
        type="button"
        class="text-2xl rounded p-2 transition active:scale-95 hover:scale-110"
        [title]="emoji.unicodeName">
        {{ emoji.character }}
      </button>
    </div>
    <div *ngIf="!emojisCargados" class="text-center py-4"
         [style.color]="'var(--picker-text-color)'">
      <i class="fas fa-spinner fa-spin"></i> Cargando emojis...
    </div>
  </div>
</div>


      <!-- Opciones -->
      <div [ngClass]="currentTheme.borderColor" class="flex items-center gap-4 pt-4 border-t">
        <label
          class="flex items-center gap-2 cursor-pointer transition"
          [ngClass]="[currentTheme.textSecondaryClass, currentTheme.hoverText, publicando ? 'pointer-events-none opacity-50' : '']">
          <i class="fas fa-image text-xl"></i>
          <span class="font-medium">Foto</span>
          <input type="file" accept="image/*" (change)="onImageSelect($event)" class="hidden" [disabled]="publicando">
        </label>

        <button
          (click)="toggleEmojiPicker()"
          type="button"
          [disabled]="publicando"
          [ngClass]="[currentTheme.textSecondaryClass, currentTheme.hoverText, mostrarEmojiPicker ? currentTheme.accentColor : '', publicando ? 'opacity-50 cursor-not-allowed' : '']"
          class="flex items-center gap-2 transition">
          <i class="fas fa-smile text-xl"></i>
          <span class="font-medium">Emoji</span>
        </button>

        <button
          (click)="toggleSelectorCategoria()"
          type="button"
          [disabled]="publicando"
          [ngClass]="[currentTheme.textSecondaryClass, currentTheme.hoverText, mostrarSelectorCategoria ? currentTheme.accentColor : '', publicando ? 'opacity-50 cursor-not-allowed' : '']"
          class="flex items-center gap-2 transition">
          <i class="fas fa-tag text-xl"></i>
          <span class="font-medium">Categoría</span>
        </button>
      </div>

      <!-- Botón publicar -->
      <button
        (click)="publicarPost()"
        [disabled]="!postContent.trim() || publicando"
        style="width: 100%; color: white; padding: 0.75rem; border-radius: 0.75rem; font-weight: 700; border: none; transition: all 0.3s;"
        [ngStyle]="{'background': publicando || !postContent.trim() ? 'lightgray' : currentTheme.buttonGradient}"
        [style.opacity]="!postContent.trim() || publicando ? '0.5' : '1'"
        [style.cursor]="!postContent.trim() || publicando ? 'not-allowed' : 'pointer'"
      >
        <i [class]="publicando ? 'fas fa-spinner fa-spin mr-2' : 'fas fa-paper-plane mr-2'"></i>
        {{ publicando ? 'Publicando...' : 'Publicar' }}
      </button>
    </div>
  </div>
</div>